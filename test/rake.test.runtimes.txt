2018-10-14-03:09:25 PM molecule test start
--> Validating schema /home/paul/wip/dot-dash/test/deployment/roles/serverspec/molecule/default/molecule.yml.
Validation completed successfully.
--> Test matrix

└── default
    ├── lint
    ├── destroy
    ├── dependency
    ├── syntax
    ├── create
    ├── prepare
    ├── converge
    ├── idempotence
    ├── side_effect
    ├── verify
    └── destroy

--> Scenario: 'default'
--> Action: 'lint'
--> Executing Yamllint on files found in /home/paul/wip/dot-dash/test/deployment/roles/serverspec/...
Lint completed successfully.
--> Executing Flake8 on files found in /home/paul/wip/dot-dash/test/deployment/roles/serverspec/molecule/default/tests/...
Lint completed successfully.
--> Executing Ansible Lint on /home/paul/wip/dot-dash/test/deployment/roles/serverspec/molecule/default/playbook.yml...
Lint completed successfully.
--> Scenario: 'default'
--> Action: 'destroy'

    PLAY [Destroy] *****************************************************************

    TASK [Destroy molecule instance(s)] ********************************************
    changed: [localhost] => (item=None)
    changed: [localhost]

    TASK [Wait for instance(s) deletion to complete] *******************************
    ok: [localhost] => (item=None)
    ok: [localhost]

    TASK [Delete docker network(s)] ************************************************

    PLAY RECAP *********************************************************************
    localhost                  : ok=2    changed=1    unreachable=0    failed=0


--> Scenario: 'default'
--> Action: 'dependency'
Skipping, missing the requirements file.
--> Scenario: 'default'
--> Action: 'syntax'

    playbook: /home/paul/wip/dot-dash/test/deployment/roles/serverspec/molecule/default/playbook.yml

--> Scenario: 'default'
--> Action: 'create'

    PLAY [Create] ******************************************************************

    TASK [Log into a Docker registry] **********************************************
    skipping: [localhost] => (item=None)

    TASK [Create Dockerfiles from image names] *************************************
    changed: [localhost] => (item=None)
    changed: [localhost]

    TASK [Discover local Docker images] ********************************************
    ok: [localhost] => (item=None)
    ok: [localhost]

    TASK [Build an Ansible compatible image] ***************************************
    changed: [localhost] => (item=None)
    changed: [localhost]

    TASK [Create docker network(s)] ************************************************

    TASK [Create molecule instance(s)] *********************************************
    changed: [localhost] => (item=None)
    changed: [localhost]

    TASK [Wait for instance(s) creation to complete] *******************************
    changed: [localhost] => (item=None)
    changed: [localhost]

    PLAY RECAP *********************************************************************
    localhost                  : ok=5    changed=4    unreachable=0    failed=0


--> Scenario: 'default'
--> Action: 'prepare'
Skipping, prepare playbook not configured.
--> Scenario: 'default'
--> Action: 'converge'

    PLAY [Converge] ****************************************************************

    TASK [Gathering Facts] *********************************************************
    ok: [instance]

    PLAY RECAP *********************************************************************
    instance                   : ok=1    changed=0    unreachable=0    failed=0


--> Scenario: 'default'
--> Action: 'idempotence'
Idempotence completed successfully.
--> Scenario: 'default'
--> Action: 'side_effect'
Skipping, side effect playbook not configured.
--> Scenario: 'default'
--> Action: 'verify'
--> Executing Testinfra tests found in /home/paul/wip/dot-dash/test/deployment/roles/serverspec/molecule/default/tests/...
    ============================= test session starts ==============================
    platform linux -- Python 3.6.6, pytest-3.8.2, py-1.7.0, pluggy-0.7.1
    rootdir: /home/paul/wip/dot-dash/test/deployment/roles/serverspec/molecule/default, inifile:
    plugins: testinfra-1.16.0, spec-1.1.0
    collecting 0 items                                                             collecting 1 item                                                              collecting 2 items                                                             collected 2 items

    tests/test_default.py::
        [PASS]  Hosts file[ansible://instance]

    tests/test_metricbeat.py::
        [FAIL]  Metricbeat[ansible://instance]                               [100%]

    =================================== FAILURES ===================================
    _____________________ test_metricbeat[ansible://instance] ______________________

    host = <testinfra.host.Host object at 0x7fc6cfdbc5f8>

        def test_metricbeat(host):
    >       assert host.package('metricbeat').is_installed
    E       AssertionError: assert False
    E        +  where False = <package metricbeat>.is_installed
    E        +    where <package metricbeat> = <class 'testinfra.modules.base.RpmPackage'>('metricbeat')
    E        +      where <class 'testinfra.modules.base.RpmPackage'> = <testinfra.host.Host object at 0x7fc6cfdbc5f8>.package

    tests/test_metricbeat.py:16: AssertionError
     generated xml file: /home/paul/wip/dot-dash/test/deployment/roles/serverspec/molecule/default/testinfra-junit-xml.out
    =========================== short test summary info ============================
    FAIL tests/test_metricbeat.py::test_metricbeat[ansible://instance]
    ============================ slowest test durations ============================
    4.62s call     tests/test_default.py::test_hosts_file[ansible://instance]
    1.66s call     tests/test_metricbeat.py::test_metricbeat[ansible://instance]
    0.00s setup    tests/test_default.py::test_hosts_file[ansible://instance]
    0.00s teardown tests/test_default.py::test_hosts_file[ansible://instance]
    0.00s setup    tests/test_metricbeat.py::test_metricbeat[ansible://instance]
    0.00s teardown tests/test_metricbeat.py::test_metricbeat[ansible://instance]
    ====================== 1 failed, 1 passed in 6.73 seconds ======================
An error occurred during the test sequence action: 'verify'. Cleaning up.
--> Scenario: 'default'
--> Action: 'destroy'

    PLAY [Destroy] *****************************************************************

    TASK [Destroy molecule instance(s)] ********************************************
    changed: [localhost] => (item=None)
    changed: [localhost]

    TASK [Wait for instance(s) deletion to complete] *******************************
    changed: [localhost] => (item=None)
    changed: [localhost]

    TASK [Delete docker network(s)] ************************************************

    PLAY RECAP *********************************************************************
    localhost                  : ok=2    changed=2    unreachable=0    failed=0


2018-10-14-03:09:49 PM molecule test stop
